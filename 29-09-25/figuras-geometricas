;;; geometria.lisp - Programa para calcular √°reas y vol√∫menes de figuras geom√©tricas
;;; Utiliza: setq, read, setf, let, princ

(in-package :cl-user)

;;; ============================================================================
;;; FUNCIONES AUXILIARES
;;; ============================================================================

(defun leer-numero (mensaje)
  "Lee un n√∫mero del usuario con validaci√≥n b√°sica"
  (princ mensaje)
  (let ((entrada (read)))
    (if (numberp entrada)
        entrada
        (progn
          (princ "Error: Debes ingresar un n√∫mero v√°lido. Intenta de nuevo.")
          (terpri)
          (leer-numero mensaje)))))

(defun imprimir-separador ()
  "Imprime una l√≠nea separadora"
  (princ "========================================")
  (terpri))

(defun imprimir-titulo (titulo)
  "Imprime un t√≠tulo formateado"
  (terpri)
  (imprimir-separador)
  (princ "   ")
  (princ titulo)
  (terpri)
  (imprimir-separador))

;;; ============================================================================
;;; C√ÅLCULO DE √ÅREAS (10 FIGURAS 2D)
;;; ============================================================================

(defun area-cuadrado ()
  "Calcula el √°rea de un cuadrado usando SETQ"
  (imprimir-titulo "√ÅREA DEL CUADRADO")
  (princ "F√≥rmula: A = lado¬≤")
  (terpri)
  (setq lado (leer-numero "Ingresa el lado: "))
  (setq area (* lado lado))
  (princ "El √°rea del cuadrado es: ")
  (princ area)
  (terpri)
  area)

(defun area-rectangulo ()
  "Calcula el √°rea de un rect√°ngulo usando LET"
  (imprimir-titulo "√ÅREA DEL RECT√ÅNGULO")
  (princ "F√≥rmula: A = base √ó altura")
  (terpri)
  (let ((base (leer-numero "Ingresa la base: "))
        (altura (leer-numero "Ingresa la altura: ")))
    (let ((area (* base altura)))
      (princ "El √°rea del rect√°ngulo es: ")
      (princ area)
      (terpri)
      area)))

(defun area-triangulo ()
  "Calcula el √°rea de un tri√°ngulo usando SETF"
  (imprimir-titulo "√ÅREA DEL TRI√ÅNGULO")
  (princ "F√≥rmula: A = (base √ó altura) / 2")
  (terpri)
  (let ((base nil)
        (altura nil)
        (area nil))
    (setf base (leer-numero "Ingresa la base: "))
    (setf altura (leer-numero "Ingresa la altura: "))
    (setf area (/ (* base altura) 2.0))
    (princ "El √°rea del tri√°ngulo es: ")
    (princ area)
    (terpri)
    area))

(defun area-circulo ()
  "Calcula el √°rea de un c√≠rculo usando SETQ"
  (imprimir-titulo "√ÅREA DEL C√çRCULO")
  (princ "F√≥rmula: A = œÄ √ó radio¬≤")
  (terpri)
  (setq radio (leer-numero "Ingresa el radio: "))
  (setq pi 3.141592653589793)
  (setq area (* pi radio radio))
  (princ "El √°rea del c√≠rculo es: ")
  (princ area)
  (terpri)
  area)

(defun area-trapecio ()
  "Calcula el √°rea de un trapecio usando LET"
  (imprimir-titulo "√ÅREA DEL TRAPECIO")
  (princ "F√≥rmula: A = ((base_mayor + base_menor) √ó altura) / 2")
  (terpri)
  (let* ((base-mayor (leer-numero "Ingresa la base mayor: "))
         (base-menor (leer-numero "Ingresa la base menor: "))
         (altura (leer-numero "Ingresa la altura: "))
         (area (/ (* (+ base-mayor base-menor) altura) 2.0)))
    (princ "El √°rea del trapecio es: ")
    (princ area)
    (terpri)
    area))

(defun area-rombo ()
  "Calcula el √°rea de un rombo usando SETF"
  (imprimir-titulo "√ÅREA DEL ROMBO")
  (princ "F√≥rmula: A = (diagonal_mayor √ó diagonal_menor) / 2")
  (terpri)
  (let ((d-mayor nil)
        (d-menor nil)
        (area nil))
    (setf d-mayor (leer-numero "Ingresa la diagonal mayor: "))
    (setf d-menor (leer-numero "Ingresa la diagonal menor: "))
    (setf area (/ (* d-mayor d-menor) 2.0))
    (princ "El √°rea del rombo es: ")
    (princ area)
    (terpri)
    area))

(defun area-pentagono ()
  "Calcula el √°rea de un pent√°gono regular usando SETQ"
  (imprimir-titulo "√ÅREA DEL PENT√ÅGONO REGULAR")
  (princ "F√≥rmula: A = (per√≠metro √ó apotema) / 2")
  (terpri)
  (setq lado (leer-numero "Ingresa el lado: "))
  (setq apotema (leer-numero "Ingresa el apotema: "))
  (setq perimetro (* 5 lado))
  (setq area (/ (* perimetro apotema) 2.0))
  (princ "El √°rea del pent√°gono es: ")
  (princ area)
  (terpri)
  area)

(defun area-hexagono ()
  "Calcula el √°rea de un hex√°gono regular usando LET"
  (imprimir-titulo "√ÅREA DEL HEX√ÅGONO REGULAR")
  (princ "F√≥rmula: A = (3‚àö3 / 2) √ó lado¬≤")
  (terpri)
  (let* ((lado (leer-numero "Ingresa el lado: "))
         (raiz-3 1.732050807568877)
         (area (* (/ (* 3 raiz-3) 2) lado lado)))
    (princ "El √°rea del hex√°gono es: ")
    (princ area)
    (terpri)
    area))

(defun area-elipse ()
  "Calcula el √°rea de una elipse usando SETF"
  (imprimir-titulo "√ÅREA DE LA ELIPSE")
  (princ "F√≥rmula: A = œÄ √ó semi-eje-mayor √ó semi-eje-menor")
  (terpri)
  (let ((eje-a nil)
        (eje-b nil)
        (area nil))
    (setf eje-a (leer-numero "Ingresa el semi-eje mayor: "))
    (setf eje-b (leer-numero "Ingresa el semi-eje menor: "))
    (setf area (* 3.141592653589793 eje-a eje-b))
    (princ "El √°rea de la elipse es: ")
    (princ area)
    (terpri)
    area))

(defun area-paralelogramo ()
  "Calcula el √°rea de un paralelogramo usando SETQ"
  (imprimir-titulo "√ÅREA DEL PARALELOGRAMO")
  (princ "F√≥rmula: A = base √ó altura")
  (terpri)
  (setq base (leer-numero "Ingresa la base: "))
  (setq altura (leer-numero "Ingresa la altura: "))
  (setq area (* base altura))
  (princ "El √°rea del paralelogramo es: ")
  (princ area)
  (terpri)
  area)

;;; ============================================================================
;;; C√ÅLCULO DE VOL√öMENES (10 FIGURAS 3D)
;;; ============================================================================

(defun volumen-cubo ()
  "Calcula el volumen de un cubo usando SETQ"
  (imprimir-titulo "VOLUMEN DEL CUBO")
  (princ "F√≥rmula: V = lado¬≥")
  (terpri)
  (setq lado (leer-numero "Ingresa el lado: "))
  (setq volumen (* lado lado lado))
  (princ "El volumen del cubo es: ")
  (princ volumen)
  (terpri)
  volumen)

(defun volumen-prisma-rectangular ()
  "Calcula el volumen de un prisma rectangular usando LET"
  (imprimir-titulo "VOLUMEN DEL PRISMA RECTANGULAR")
  (princ "F√≥rmula: V = largo √ó ancho √ó alto")
  (terpri)
  (let ((largo (leer-numero "Ingresa el largo: "))
        (ancho (leer-numero "Ingresa el ancho: "))
        (alto (leer-numero "Ingresa el alto: ")))
    (let ((volumen (* largo ancho alto)))
      (princ "El volumen del prisma rectangular es: ")
      (princ volumen)
      (terpri)
      volumen)))

(defun volumen-esfera ()
  "Calcula el volumen de una esfera usando SETF"
  (imprimir-titulo "VOLUMEN DE LA ESFERA")
  (princ "F√≥rmula: V = (4/3) √ó œÄ √ó radio¬≥")
  (terpri)
  (let ((radio nil)
        (volumen nil))
    (setf radio (leer-numero "Ingresa el radio: "))
    (setf volumen (* (/ 4.0 3.0) 3.141592653589793 radio radio radio))
    (princ "El volumen de la esfera es: ")
    (princ volumen)
    (terpri)
    volumen))

(defun volumen-cilindro ()
  "Calcula el volumen de un cilindro usando SETQ"
  (imprimir-titulo "VOLUMEN DEL CILINDRO")
  (princ "F√≥rmula: V = œÄ √ó radio¬≤ √ó altura")
  (terpri)
  (setq radio (leer-numero "Ingresa el radio: "))
  (setq altura (leer-numero "Ingresa la altura: "))
  (setq pi 3.141592653589793)
  (setq volumen (* pi radio radio altura))
  (princ "El volumen del cilindro es: ")
  (princ volumen)
  (terpri)
  volumen)

(defun volumen-cono ()
  "Calcula el volumen de un cono usando LET"
  (imprimir-titulo "VOLUMEN DEL CONO")
  (princ "F√≥rmula: V = (1/3) √ó œÄ √ó radio¬≤ √ó altura")
  (terpri)
  (let* ((radio (leer-numero "Ingresa el radio: "))
         (altura (leer-numero "Ingresa la altura: "))
         (pi 3.141592653589793)
         (volumen (* (/ 1.0 3.0) pi radio radio altura)))
    (princ "El volumen del cono es: ")
    (princ volumen)
    (terpri)
    volumen))

(defun volumen-piramide ()
  "Calcula el volumen de una pir√°mide usando SETF"
  (imprimir-titulo "VOLUMEN DE LA PIR√ÅMIDE")
  (princ "F√≥rmula: V = (1/3) √ó √°rea_base √ó altura")
  (terpri)
  (let ((area-base nil)
        (altura nil)
        (volumen nil))
    (setf area-base (leer-numero "Ingresa el √°rea de la base: "))
    (setf altura (leer-numero "Ingresa la altura: "))
    (setf volumen (* (/ 1.0 3.0) area-base altura))
    (princ "El volumen de la pir√°mide es: ")
    (princ volumen)
    (terpri)
    volumen))

(defun volumen-prisma-triangular ()
  "Calcula el volumen de un prisma triangular usando SETQ"
  (imprimir-titulo "VOLUMEN DEL PRISMA TRIANGULAR")
  (princ "F√≥rmula: V = (base √ó altura_triangulo / 2) √ó longitud")
  (terpri)
  (setq base (leer-numero "Ingresa la base del tri√°ngulo: "))
  (setq altura-tri (leer-numero "Ingresa la altura del tri√°ngulo: "))
  (setq longitud (leer-numero "Ingresa la longitud del prisma: "))
  (setq volumen (* (/ (* base altura-tri) 2.0) longitud))
  (princ "El volumen del prisma triangular es: ")
  (princ volumen)
  (terpri)
  volumen)

(defun volumen-tetraedro ()
  "Calcula el volumen de un tetraedro regular usando LET"
  (imprimir-titulo "VOLUMEN DEL TETRAEDRO REGULAR")
  (princ "F√≥rmula: V = (lado¬≥) / (6‚àö2)")
  (terpri)
  (let* ((lado (leer-numero "Ingresa el lado: "))
         (raiz-2 1.414213562373095)
         (volumen (/ (* lado lado lado) (* 6 raiz-2))))
    (princ "El volumen del tetraedro es: ")
    (princ volumen)
    (terpri)
    volumen))

(defun volumen-toro ()
  "Calcula el volumen de un toro usando SETF"
  (imprimir-titulo "VOLUMEN DEL TORO (DONA)")
  (princ "F√≥rmula: V = 2œÄ¬≤ √ó R √ó r¬≤")
  (princ "  (R = radio mayor, r = radio menor)")
  (terpri)
  (let ((r-mayor nil)
        (r-menor nil)
        (volumen nil))
    (setf r-mayor (leer-numero "Ingresa el radio mayor (del centro al tubo): "))
    (setf r-menor (leer-numero "Ingresa el radio menor (del tubo): "))
    (setf volumen (* 2 (* 3.141592653589793 3.141592653589793) r-mayor r-menor r-menor))
    (princ "El volumen del toro es: ")
    (princ volumen)
    (terpri)
    volumen))

(defun volumen-elipsoide ()
  "Calcula el volumen de un elipsoide usando SETQ"
  (imprimir-titulo "VOLUMEN DEL ELIPSOIDE")
  (princ "F√≥rmula: V = (4/3) √ó œÄ √ó a √ó b √ó c")
  (terpri)
  (setq a (leer-numero "Ingresa el semi-eje a: "))
  (setq b (leer-numero "Ingresa el semi-eje b: "))
  (setq c (leer-numero "Ingresa el semi-eje c: "))
  (setq pi 3.141592653589793)
  (setq volumen (* (/ 4.0 3.0) pi a b c))
  (princ "El volumen del elipsoide es: ")
  (princ volumen)
  (terpri)
  volumen)

;;; ============================================================================
;;; MEN√ö PRINCIPAL
;;; ============================================================================

(defun menu-areas ()
  "Men√∫ para calcular √°reas"
  (imprimir-titulo "üî∑ MEN√ö DE √ÅREAS üî∑")
  (princ "1.  Cuadrado")
  (terpri)
  (princ "2.  Rect√°ngulo")
  (terpri)
  (princ "3.  Tri√°ngulo")
  (terpri)
  (princ "4.  C√≠rculo")
  (terpri)
  (princ "5.  Trapecio")
  (terpri)
  (princ "6.  Rombo")
  (terpri)
  (princ "7.  Pent√°gono regular")
  (terpri)
  (princ "8.  Hex√°gono regular")
  (terpri)
  (princ "9.  Elipse")
  (terpri)
  (princ "10. Paralelogramo")
  (terpri)
  (princ "0.  Volver al men√∫ principal")
  (terpri)
  (princ "Elige una opci√≥n: ")
  (let ((opcion (read)))
    (case opcion
      (1 (area-cuadrado))
      (2 (area-rectangulo))
      (3 (area-triangulo))
      (4 (area-circulo))
      (5 (area-trapecio))
      (6 (area-rombo))
      (7 (area-pentagono))
      (8 (area-hexagono))
      (9 (area-elipse))
      (10 (area-paralelogramo))
      (0 (return-from menu-areas nil))
      (otherwise 
       (princ "Opci√≥n no v√°lida")
       (terpri)))
    (unless (= opcion 0)
      (terpri)
      (princ "Presiona Enter para continuar...")
      (read-line)
      (read-line)
      (menu-areas))))

(defun menu-volumenes ()
  "Men√∫ para calcular vol√∫menes"
  (imprimir-titulo "üî∂ MEN√ö DE VOL√öMENES üî∂")
  (princ "1.  Cubo")
  (terpri)
  (princ "2.  Prisma rectangular")
  (terpri)
  (princ "3.  Esfera")
  (terpri)
  (princ "4.  Cilindro")
  (terpri)
  (princ "5.  Cono")
  (terpri)
  (princ "6.  Pir√°mide")
  (terpri)
  (princ "7.  Prisma triangular")
  (terpri)
  (princ "8.  Tetraedro regular")
  (terpri)
  (princ "9.  Toro (dona)")
  (terpri)
  (princ "10. Elipsoide")
  (terpri)
  (princ "0.  Volver al men√∫ principal")
  (terpri)
  (princ "Elige una opci√≥n: ")
  (let ((opcion (read)))
    (case opcion
      (1 (volumen-cubo))
      (2 (volumen-prisma-rectangular))
      (3 (volumen-esfera))
      (4 (volumen-cilindro))
      (5 (volumen-cono))
      (6 (volumen-piramide))
      (7 (volumen-prisma-triangular))
      (8 (volumen-tetraedro))
      (9 (volumen-toro))
      (10 (volumen-elipsoide))
      (0 (return-from menu-volumenes nil))
      (otherwise 
       (princ "Opci√≥n no v√°lida")
       (terpri)))
    (unless (= opcion 0)
      (terpri)
      (princ "Presiona Enter para continuar...")
      (read-line)
      (read-line)
      (menu-volumenes))))

(defun menu-principal ()
  "Men√∫ principal del programa"
  (loop
    (imprimir-titulo "üìê CALCULADORA DE GEOMETR√çA üìê")
    (princ "1. Calcular √ÅREAS (10 figuras 2D)")
    (terpri)
    (princ "2. Calcular VOL√öMENES (10 figuras 3D)")
    (terpri)
    (princ "3. Salir")
    (terpri)
    (princ "Elige una opci√≥n: ")
    (let ((opcion (read)))
      (case opcion
        (1 (menu-areas))
        (2 (menu-volumenes))
        (3 (progn
             (terpri)
             (princ "¬°Gracias por usar la calculadora de geometr√≠a!")
             (terpri)
             (return)))
        (otherwise 
         (princ "Opci√≥n no v√°lida. Intenta de nuevo.")
         (terpri)
         (terpri))))))

;;; ============================================================================
;;; INICIALIZACI√ìN
;;; ============================================================================

(princ "========================================")
(terpri)
(princ "   Programa cargado correctamente")
(terpri)
(princ "   Ejecuta: (menu-principal)")
(terpri)
(princ "========================================")
(terpri)